<html>
<head>
	<link href="lib/c3.css" rel="stylesheet" type="text/css">
	<link href="lib/bootstrap.min.css" rel="stylesheet" type="text/css">

	<script src="lib/d3.min.js" charset="utf-8"></script>
	<script src="lib/c3.js" type="text/javascript"></script>
	<script src="peg-0.8.0.min.js" type="text/javascript"></script>
	<script src="parser.js" type="text/javascript"></script>

	<script type="text/javascript">
		function parse(n) {
			var text = document.getElementById("input").value;
			var parsed = parser.parse(text)
			var output = JSON.stringify(parsed, null, 4); 

			document.getElementById("tree").style.display = 'none';
			document.getElementById("code").innerHTML = output;

      var modData = [];
      var chartType
      switch(n) {
        case 0:
        	 chartType = (parsed[1].value).toString()
        break;
        case 1:
        	chartType = 'bar'
        break;
        case 2:
        	chartType = 'pie'
        break;
        case 3:
        	chartType = 'line'
        break;
        case 4:
        	chartType = 'area'
        break;
        case 5:
        	chartType = 'area-spline'
        break;
        case 6:
        	chartType = 'donut'
        break;
        case 7:
        	chartType = 'scatter'
        break;
        default:
        chartType = 'bar'
      }

     	var labels
     	var parsedJson = parsed

      parsed[0].array.forEach(function(d, i) {
        console.log(d)
        var item = [d.type];
        item.push(d.value);
        modData.push(item);
			});

      var chart = c3.generate({
        data: { son: modData, type: chartType}
      });
		}
	</script>	
</head>

<body>
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-5 col-md-offset-1">
				<h3>Chart code</h3>
				<textarea id="input" name="input" class="form-control" rows="20">
#data: 1,2,3
#type: bar
#color: red</textarea>
				<input class="btn btn-default label-success" type="submit" value="PLOT" onclick="parse(0)">
        <input class="btn btn-default" type="submit" value="SAVE SVG">
        <input class="btn btn-default" type="submit" value="Bar" onclick="parse(1)">
        <input class="btn btn-default" type="submit" value="Pie" onclick="parse(2)">
        <input class="btn btn-default" type="submit" value="Line" onclick="parse(3)">
        <input class="btn btn-default" type="submit" value="Area" onclick="parse(4)">
        <input class="btn btn-default" type="submit" value="Area Spline" onclick="parse(5)">
        <input class="btn btn-default" type="submit" value="Donut" onclick="parse(6)">
        <input class="btn btn-default" type="submit" value="Scatter" onclick="parse(7)"><br/><br/>

        <div id="chart" class="col-md-12 col-md-offset-0" style="height:500px;"></div>
			</div>
		
			<div class="col-md-5 col-md-offset-0">
				<h3>Tree</h3>
				<p id="tree">Parse tree will appear here</p>
				<pre id="code"></pre>
			</div>

		</div>
	</div>
</body>
</html>